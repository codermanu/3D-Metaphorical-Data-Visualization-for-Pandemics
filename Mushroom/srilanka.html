<!DOCTYPE html>
<html lang="en">
  <head>
    <title>three.js webgl - cloth simulation</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
    />
    <style>
      body {
        font-family: Monospace;
        background-color: #000;
        color: #000;
        margin: 0px;
        overflow: hidden;
      }
    </style>
  </head>

  <body>
    <script src="./threejs/build/three.min.js"></script>
    <script src="./cs291-master/lib/Coordinates.js"></script>
    <script src="./cs291-master/lib/OrbitAndPanControls.new.js"></script>
    <script src="./cs291-master/lib/dat.gui.min.js"></script>
    <script src="./tween.js-master/src/Tween.js"></script>
    <script src="./js/mushroom.js"></script>
    <script src="./js/distrctwithpixce.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/92/three.min.js"></script>
    <script src="OrbitControl.js"></script>

    <!-- <script src="https://cdn.rawgit.com/mrdoob/three.js/dev/examples/js/controls/OrbitControls.js"></script> -->
    <script src="https://cdn.rawgit.com/mrdoob/three.js/dev/examples/js/renderers/CSS3DRenderer.js"></script>
    <script src="https://cdn.rawgit.com/mrdoob/three.js/dev/examples/js/libs/stats.min.js"></script>

    <script src="cone.js"></script>
    <script>
      /*global THREE, Coordinates, document, window, dat*/

      var camera, scene, renderer, projector;
      var cameraControls, effectController;

      var clock = new THREE.Clock();
      var canvasWidth = 640;
      var canvasHeight = 480;

      var rSeg = 32;
      var hSeg = 8;

      var showSpotCam = false;
      var isDaytime = true;
      var animateWater = true;
      var closeView = false;

      var bubbleCount = 50;
      var bubblePartSys;
      var bubbleTextureDay, bubbleTextureNight; //so can switch for night and day

      var objects = []; //list of mesh  in the scene that check for onmousedown

      var daylight, nightlight; //arrays to hold lights for day and nights
      var riverMat; //made global so can access for animation in render func

      var mushroomList = []; //list of Mushroom objects (mushroom.js)
      var smallMushrooms = []; //list of generated mushrooms

      var moon;
      var moonlight;
      var bfly1;
      var MapElement = function (id, x, y, z, rx) {
        var div = document.createElement("div");
        div.id = id;
        div.style.width = "1200px";
        div.style.height = "950px";
        //	div.style.backgroundColor = 'red';

        var object = new THREE.CSS3DObject(div);
        object.position.set(x, y, z);
        object.rotation.x = rx;
        return object;
      };

      var container, stats;
      var camera, scene, renderer, renderer1, controls;

      var sphere;
      //var cone;
      // var object;
      var objects = [];

      init();
      drawMushroom();
	  animate();
	  importCSV();

      function init() {
        console.log(districtWithpxl);
        container = document.createElement("div");
        document.body.appendChild(container);

        // scene

        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x000000);
        scene.fog = new THREE.Fog(0xcce0ff, 500, 10000);

        // camera

        camera = new THREE.PerspectiveCamera(
          30,
          window.innerWidth / window.innerHeight,
          1,
          10000
        );
        //
        camera.position.set(
          -1630.5660632506256,
          338.2706222303878,
          -692.3346730528838
        );
        //camera.position.set(0.2538268801815511, 1329.2257935074563, -25.3884727987337);

        group = new THREE.Group();

        // lights

        var light, materials;

        scene.add(new THREE.AmbientLight(0x666666));

        light = new THREE.DirectionalLight(0xffffff, 1);
        light.position.set(50, 200, 100);
        light.position.multiplyScalar(1.3);

        light.castShadow = true;

        light.shadow.mapSize.width = 1024;
        light.shadow.mapSize.height = 1024;

        var d = 300;

        light.shadow.camera.left = -d;
        light.shadow.camera.right = d;
        light.shadow.camera.top = d;
        light.shadow.camera.bottom = -d;

        light.shadow.camera.far = 1000;

        scene.add(light);

        // const geometry3 = new THREE.BoxBufferGeometry( 1, 1, 1 );
        // const material4 = new THREE.MeshBasicMaterial( {color: 0XFF0000} );

        // const cubeA = new THREE.Mesh( geometry3, material4 );
        // //cubeA.position.set( 100, 100, 0 );
        // cubeA.position.copy( new THREE.Vector3( 0, - 45, 0 ) );

        // const cubeB = new THREE.Mesh( geometry3, material4 );
        // 	cubeB.position.set(  new THREE.Vector3( 15, - 25, 15 ) );

        // group.add( cubeA );
        // group.add( cubeB );
        // scene.add( group );
        // console.log('*******************');

        //Add cones from the cone.js
        // scene.add(group1);

        // ground
        var PLANE_SIZE = 2000;
        var MAP_SIZE = 512;

        var ZOOM = 7; //Static Map zoom

        var loader = new THREE.TextureLoader();
        var groundTexture = loader.load(
          "http://maps.googleapis.com/maps/api/staticmap?center=" +
            " 7.8731, 80.7718" +
            "&scale=2&zoom=" +
            ZOOM +
            "&size=" +
            MAP_SIZE +
            "x" +
            MAP_SIZE +
            "&maptype=roadmap&sensor=false&path=color:red|weight:2|fillcolor:white|enc:" +
            "&key=AIzaSyBp7LT-AfWOztGLh-L5_5YRmw5HeNiiNYA"
        );
        //var groundTexture = loader.load('download.jpeg');
        groundTexture.wrapS = groundTexture.wrapT = THREE.RepeatWrapping;
        groundTexture.repeat.set(1, 1);
        groundTexture.anisotropy = 16;
        Math.PI;

        var groundMaterial = new THREE.MeshLambertMaterial({
          map: groundTexture,
        });

        var mesh = new THREE.Mesh(
          new THREE.PlaneBufferGeometry(2000, 2000),
          groundMaterial
        );
        mesh.position.y = -200;
        mesh.rotation.x = -Math.PI / 2;
        mesh.receiveShadow = true;
        scene.add(mesh);

        var mapObject = new MapElement("googleMap", 0, 0, 540, 270);
        group.add(mapObject);
        group.position.y = -459;

        group.rotation.x = 1.3819063267948963; // - Math.PI / 2;
        group.rotation.y = -3.14159265358979; // - Math.PI;

        scene.add(group);

        // renderer

        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(window.innerWidth, window.innerHeight);

        renderer1 = new THREE.CSS3DRenderer();
        renderer1.setSize(window.innerWidth, window.innerHeight);

        renderer1.domElement.style.position = "absolute";
        // renderer1.domElement.style.top = 0;

        container.appendChild(renderer1.domElement);
        container.appendChild(renderer.domElement);

        renderer.gammaInput = true;
        renderer.gammaOutput = true;

        renderer.shadowMap.enabled = true;

        // controls
        controls = new THREE.OrbitControls(camera);
        controls.maxPolarAngle = Math.PI * 0.5;
        controls.minDistance = 1000;
        controls.maxDistance = 5000;

        // performance monitor

        stats = new Stats();
        container.appendChild(stats.dom);

        //

        window.addEventListener("resize", onWindowResize, false);

        // create the mushroom
      }

      //import the csv

      function importCSV() {
        console.log("called");
        var xmlhttp = new XMLHttpRequest();
        xmlhttp.onreadystatechange = function () {
          if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
            console.log("imported");
            var ports = CSVToArray(xmlhttp.responseText, ";");
            ports.forEach(function (e) {
              let jsonCountry = {};
              console.log(e);
              
            });
            console.log(countryArrfromcsv);
            WP.updateBars(countryArrfromcsv);
          }
        };

        xmlhttp.open("GET", "../dataset-district/small-set.csv", true);
        xmlhttp.send();
      }

      function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();

        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer1.setSize(window.innerWidth, window.innerHeight);

        // webGLRenderer.setSize(window.innerWidth, window.innerHeight);
        // dynamicMapRenderer.setSize(window.innerWidth, window.innerHeight);
        // canvasRenderer.setSize(window.innerWidth, window.innerHeight);
      }

      //

      function animate() {
        requestAnimationFrame(animate);

        render();
        stats.update();
      }

      function render() {
        renderer1.render(scene, camera);
        renderer.render(scene, camera);
      }

      // Functions related to mushroom

      function drawMushroom() {
        var districts = [
          ["Ampara", 1, 7.29754, 81.68202],
          ["Anuradhapura", 2, 8.31223, 80.41306],
          ["Badulla", 3, 6.9895, 81.0557],
          ["Batticaloa", 4, 7.7102, 81.6924],
          ["Colombo", 5, 6.93194, 79.84778],
          ["Galle", 6, 6.0367, 80.217],
          ["Gampaha", 7, 7.08731, 80.014366],
          ["Hambantota", 8, 6.1429, 81.1212],
          ["Jaffna", 9, 9.66845, 80.00742],
          ["Kalutara", 10, 6.5831, 79.9593],
          ["Kandy", 11, 7.2955, 80.6356],
          ["Kegalle", 12, 7.2513, 80.3464],
          ["Kilinochchi", 13, 9.3961, 80.3982],
          ["Kurunegala", 14, 7.4863, 80.3623],
          ["Mannar", 15, 8.981, 79.9044],
          ["Matale", 16, 7.4675, 80.6234],
          ["Matara", 17, 5.94851, 80.53528],
          ["Moneragala", 18, 6.8714, 81.3487],
          ["Mullaitivu", 19, 9.2671, 80.8142],
          ["Nuwara Eliya", 20, 6.97078, 80.78286],
          ["Polonnaruwa", 21, 7.93965, 81.00274],
          ["Puttalam", 22, 8.0362, 79.8283],
          ["Ratnapura", 23, 6.68278, 80.39917],
          ["Trincomalee", 24, 8.5711, 81.2335],
          ["Vavuniya", 25, 8.7514, 80.4971],
        ];

        for (let x = 0; x < 25; x++) {}

        // capSize,stalkHeight,stalkTop,stalkBottom,capScaleY

        var m1 = new Mushroom(65, 100, 19, 15, 1.6, 1);
        var m2 = new Mushroom(65, 100, 19, 15, 1.6, 1);

        m1.setColors("0xff00ba", "0xbbba00", "0xffba00");
        //#BAFF00
        m1.setTextures("./img/cap1.png", "./img/ucap1.png", "./img/stalk1.png");

        m1.growIt();

        m1.model.id = "m1";
        m1.model.children[0].id = "cap1";
        m1.model.children[1].id = "ucap1";
        m1.model.children[2].id = "stalk1";
        m1.model.children[2].material.map.wrapT = THREE.RepeatWrapping;
        m1.model.children[0].material.map.wrapS = THREE.RepeatWrapping;
        m1.model.children[0].material.map.repeat.set(3, 1);

        // m1.model.position.x = 100;

        // adding the single mushroom
        m1.model.position.copy(
          new THREE.Vector3(-263.70491733576927, -150, -667.9713237287366)
        );
        // mushroom group 2
        m2.setColors("0xff00ba", "0xbbba00", "0xffba00");
        //#BAFF00
        m2.setTextures("./img/cap1.png", "./img/ucap1.png", "./img/stalk1.png");

        m2.growIt();

        m2.model.id = "m2";
        m2.model.children[0].id = "cap1";
        m2.model.children[1].id = "ucap1";
        m2.model.children[2].id = "stalk1";
        m2.model.children[2].material.map.wrapT = THREE.RepeatWrapping;
        m2.model.children[0].material.map.wrapS = THREE.RepeatWrapping;
        m2.model.children[0].material.map.repeat.set(3, 1);

        m2.model.position.x = 100;

        // adding the single mushroom
        // m2.model.position.copy(
        //   new THREE.Vector3(-40.240137585480284, +40,  204.67288742878964)
        // );

        // var newMushroomGroup=new THREE.Group()
        // newMushroomGroup.add(m1)

        var shroomGroup = new THREE.Object3D();
        var shroomGroup2 = new THREE.Object3D();

        shroomGroup.add(m1.model);
        // shroomGroup.add(m2.model);
        // leftright topdown frontback
        shroomGroup.position.copy(new THREE.Vector3(0, 0, 0));

        // shroomGroup2.position.copy(
        //   new THREE.Vector3(-40.240137585480284, -200,  204.67288742878964)
        // );
        // copy(new THREE.Vector3(141.39527860089362, -100, -262.84823731300366))
        scene.add(shroomGroup);
        // scene.add(shroomGroup2);

        //push (cap, undercap, stalk) onto object array so can detect intersect when click
        for (var i = 0; i < 3; i++) {
          objects.push(m1.model.children[i]);
        }

        mushroomList.push(m1);

        //use traverse code snippet from udacity cs291
        mushroomList[0].model.traverse(function (object) {
          if (object instanceof THREE.Mesh) {
            object.castShadow = true;
            //object.receiveShadow = true;
          }
        });
      }
    </script>
  </body>
</html>
