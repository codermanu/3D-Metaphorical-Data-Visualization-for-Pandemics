<!DOCTYPE html>
<html lang="en">
  <head>
    <title>three.js webgl - cloth simulation</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
    />
    <style>
      body {
        font-family: Monospace;
        background-color: #000;
        color: #000;
        margin: 0px;
        overflow: hidden;
      }
    </style>
  </head>
  <div id="tooltip"><span>123</span></div>

  <body>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/92/three.min.js"></script>
    <script src="js/OrbitControl.js"></script>
    <script src="js/OrbitAndPanControls.new.js"></script>

    <!-- <script src="https://cdn.rawgit.com/mrdoob/three.js/dev/examples/js/controls/OrbitControls.js"></script> -->
    <script src="https://cdn.rawgit.com/mrdoob/three.js/dev/examples/js/renderers/CSS3DRenderer.js"></script>
    <script src="https://cdn.rawgit.com/mrdoob/three.js/dev/examples/js/libs/stats.min.js"></script>

    <script src="js/cone.js"></script>
    <!-- <script src="js/stats.module.js"></script> -->

    <!-- <script src="./cs291-master/lib/OrbitAndPanControls.new.js"></script> -->
    <!-- mushroom -->
    <!-- <script src="./js/OrbitAndPanControls.new.js"></script>
    <script src="./js/mushroom.js"></script>
    <script src="./threejs/build/three.min.js"></script>
    <script src="./cs291-master/lib/Coordinates.js"></script>
    <script src="./cs291-master/lib/OrbitAndPanControls.new.js"></script>
    <script src="./cs291-master/lib/dat.gui.min.js"></script>
    <script src="./tween.js-master/src/Tween.js"></script>
    <script src="./js/mushroom.js"></script>
    <script src="./js/distrctwithpixce.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/92/three.min.js"></script>
    <script src="OrbitControl.js"></script> -->

    <!-- <script src="https://cdn.rawgit.com/mrdoob/three.js/dev/examples/js/controls/OrbitControls.js"></script> -->
    <script src="https://cdn.rawgit.com/mrdoob/three.js/dev/examples/js/renderers/CSS3DRenderer.js"></script>
    <script src="https://cdn.rawgit.com/mrdoob/three.js/dev/examples/js/libs/stats.min.js"></script>

    <script src="./js/mushroom.js"></script>

    <script src="cone.js"></script>


    <!-- Tooltip -->
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.min.js"></script>
    <link rel="stylesheet" href="./css/tooltip.css" type="text/css">


    <script>
      /*global THREE, Coordinates, document, window, dat*/
	  	var shroomGroup
      var camera, scene, renderer, projector;
      var cameraControls, effectController;

      var clock = new THREE.Clock();
      var canvasWidth = 640;
      var canvasHeight = 480;

      var rSeg = 32;
      var hSeg = 8;

      var showSpotCam = false;
      var isDaytime = true;
      var animateWater = true;
      var closeView = false;

      var bubbleCount = 50;
      var bubblePartSys;
      var bubbleTextureDay, bubbleTextureNight; //so can switch for night and day

      var objects = []; //list of mesh in the scene that check for onmousedown

      var daylight, nightlight; //arrays to hold lights for day and nights
      var riverMat; //made global so can access for animation in render func

      var mushroomList = []; //list of Mushroom objects (mushroom.js)
      var smallMushrooms = []; //list of generated mushrooms

      var moon;
      var moonlight;
      var bfly1;
      var MapElement = function (id, x, y, z, rx) {
        var div = document.createElement("div");
        div.id = id;
        div.style.width = "1200px";
        div.style.height = "950px";
        //	div.style.backgroundColor = 'red';

        var object = new THREE.CSS3DObject(div);
        object.position.set(x, y, z);
        object.rotation.x = rx;
        return object;
      };

      var container, stats;
      var camera, scene, renderer, renderer1, controls;

      var sphere;
     
      init();
      drawMushroom();
      animate();
      importCSV();

      function init() {
        console.log("districtWithpxl");
        container = document.createElement("div");
        document.body.appendChild(container);

        // scene

        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x000000);
        scene.fog = new THREE.Fog(0xcce0ff, 500, 10000);

        // camera

        camera = new THREE.PerspectiveCamera(
          30,
          window.innerWidth / window.innerHeight,
          1,
          10000
        );
        //
        camera.position.set(
          -1630.5660632506256,
          338.2706222303878,
          -692.3346730528838
        );
        //camera.position.set(0.2538268801815511, 1329.2257935074563, -25.3884727987337);

        group = new THREE.Group();

        // lights
        var light, materials;

        scene.add(new THREE.AmbientLight(0x666666));

        light = new THREE.DirectionalLight(0xffffff, 1);
        light.position.set(50, 200, 100);
        light.position.multiplyScalar(1.3);

        light.castShadow = true;

        light.shadow.mapSize.width = 1024;
        light.shadow.mapSize.height = 1024;

        var d = 300;

        light.shadow.camera.left = -d;
        light.shadow.camera.right = d;
        light.shadow.camera.top = d;
        light.shadow.camera.bottom = -d;

        light.shadow.camera.far = 1000;

        scene.add(light);

      
        // ground
        var PLANE_SIZE = 2000;
        var MAP_SIZE = 512;

        var ZOOM = 7; //Static Map zoom

        var loader = new THREE.TextureLoader();
        var groundTexture = loader.load(
          "http://maps.googleapis.com/maps/api/staticmap?center=" +
            " 7.8731, 80.7718" +
            "&scale=2&zoom=" +
            ZOOM +
            "&size=" +
            MAP_SIZE +
            "x" +
            MAP_SIZE +
            "&maptype=roadmap&sensor=false&path=color:red|weight:2|fillcolor:white|enc:" +
            "&key=AIzaSyBp7LT-AfWOztGLh-L5_5YRmw5HeNiiNYA"
        );
        //var groundTexture = loader.load('download.jpeg');
        groundTexture.wrapS = groundTexture.wrapT = THREE.RepeatWrapping;
        groundTexture.repeat.set(1, 1);
        groundTexture.anisotropy = 16;
        Math.PI;

        var groundMaterial = new THREE.MeshLambertMaterial({
          map: groundTexture,
        });

        var mesh = new THREE.Mesh(
          new THREE.PlaneBufferGeometry(2000, 2000),
          groundMaterial
        );
        mesh.position.y = -200;
        mesh.rotation.x = -Math.PI / 2;
        mesh.receiveShadow = true;
        scene.add(mesh);

        var mapObject = new MapElement("googleMap", 0, 0, 540, 270);
        group.add(mapObject);
        group.position.y = -459;

        group.rotation.x = 1.3819063267948963; // - Math.PI / 2;
        group.rotation.y =-3.14159265358979; // - Math.PI;

        scene.add(group);

        // renderer
        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(window.innerWidth, window.innerHeight);

        renderer1 = new THREE.CSS3DRenderer();
        renderer1.setSize(window.innerWidth, window.innerHeight);

        renderer1.domElement.style.position = "absolute";
        // renderer1.domElement.style.top = 0;

        container.appendChild(renderer1.domElement);
        container.appendChild(renderer.domElement);

        renderer.gammaInput = true;
        renderer.gammaOutput = true;

        renderer.shadowMap.enabled = true;

        // controls
        controls = new THREE.OrbitControls(camera);
        controls.maxPolarAngle = Math.PI * 0.5;
        controls.minDistance = 1000;
        controls.maxDistance = 5000;

        // performance monitor
        stats = new Stats();
        container.appendChild(stats.dom);

        
        window.addEventListener("resize", onWindowResize, false);
        
        //This listener will be watching for click events
        document.addEventListener("mousedown", onDocumentMouseDown, false);

      }

      //import the csv
      function importCSV() {
        console.log("called");
        var xmlhttp = new XMLHttpRequest();
        xmlhttp.onreadystatechange = function () {
          if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
            console.log("imported");
            var ports = CSVToArray(xmlhttp.responseText, ";");
            ports.forEach(function (e) {
              let jsonCountry = {};
              console.log(e);
            });
            console.log(countryArrfromcsv);
            WP.updateBars(countryArrfromcsv);
          }
        };

        xmlhttp.open("GET", "./dataset-district/small-set.csv", true);
        xmlhttp.send();
      }

      function CSVToArray(strData, strDelimiter) {
        // Check to see if the delimiter is defined. If not,
        // then default to comma.
        strDelimiter = strDelimiter || ",";

        // Create a regular expression to parse the CSV values.
        var objPattern = new RegExp(
          // Delimiters.
          "(\\" +
            strDelimiter +
            "|\\r?\\n|\\r|^)" +
            // Quoted fields.
            '(?:"([^"]*(?:""[^"]*)*)"|' +
            // Standard fields.
            '([^"\\' +
            strDelimiter +
            "\\r\\n]*))",
          "gi"
        );

        // Create an array to hold our data. Give the array
        // a default empty first row.
        var arrData = [[]];

        // Create an array to hold our individual pattern
        // matching groups.
        var arrMatches = null;

        // Keep looping over the regular expression matches
        // until we can no longer find a match.
        while ((arrMatches = objPattern.exec(strData))) {
          // Get the delimiter that was found.
          var strMatchedDelimiter = arrMatches[1];

          // Check to see if the given delimiter has a length
          // (is not the start of string) and if it matches
          // field delimiter. If id does not, then we know
          // that this delimiter is a row delimiter.
          if (
            strMatchedDelimiter.length &&
            strMatchedDelimiter != strDelimiter
          ) {
            // Since we have reached a new row of data,
            // add an empty row to our data array.
            arrData.push([]);
          }

          // Now that we have our delimiter out of the way,
          // let's check to see which kind of value we
          // captured (quoted or unquoted).
          if (arrMatches[2]) {
            // We found a quoted value. When we capture
            // this value, unescape any double quotes.
            var strMatchedValue = arrMatches[2].replace(
              new RegExp('""', "g"),
              '"'
            );
          } else {
            // We found a non-quoted value.
            var strMatchedValue = arrMatches[3];
          }

          // Now that we have our value string, let's add
          // it to the data array.
          arrData[arrData.length - 1].push(strMatchedValue);
        }

        // Return the parsed data.
        return arrData;
      }

      function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();

        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer1.setSize(window.innerWidth, window.innerHeight);

        // webGLRenderer.setSize(window.innerWidth, window.innerHeight);
        // dynamicMapRenderer.setSize(window.innerWidth, window.innerHeight);
        // canvasRenderer.setSize(window.innerWidth, window.innerHeight);
      }

      function animate() {
        requestAnimationFrame(animate);

        render();
        stats.update();
      }

      function render() {
        renderer1.render(scene, camera);
        renderer.render(scene, camera);
      }


      // Functions related to mushroom
      function drawMushroom() {
        var districts = [
          ["Ampara", 1, 7.29754, 81.68202],
          ["Anuradhapura", 2, 8.31223, 80.41306],
          ["Badulla", 3, 6.9895, 81.0557],
          ["Batticaloa", 4, 7.7102, 81.6924],
          ["Colombo", 5, 6.93194, 79.84778],
          ["Galle", 6, 6.0367, 80.217],
          ["Gampaha", 7, 7.08731, 80.014366],
          ["Hambantota", 8, 6.1429, 81.1212],
          ["Jaffna", 9, 9.66845, 80.00742],
          ["Kalutara", 10, 6.5831, 79.9593],
          ["Kandy", 11, 7.2955, 80.6356],
          ["Kegalle", 12, 7.2513, 80.3464],
          ["Kilinochchi", 13, 9.3961, 80.3982],
          ["Kurunegala", 14, 7.4863, 80.3623],
          ["Mannar", 15, 8.981, 79.9044],
          ["Matale", 16, 7.4675, 80.6234],
          ["Matara", 17, 5.94851, 80.53528],
          ["Moneragala", 18, 6.8714, 81.3487],
          ["Mullaitivu", 19, 9.2671, 80.8142],
          ["Nuwara Eliya", 20, 6.97078, 80.78286],
          ["Polonnaruwa", 21, 7.93965, 81.00274],
          ["Puttalam", 22, 8.0362, 79.8283],
          ["Ratnapura", 23, 6.68278, 80.39917],
          ["Trincomalee", 24, 8.5711, 81.2335],
          ["Vavuniya", 25, 8.7514, 80.4971],
        ];

        for (let x = 0; x < 25; x++) {
        }

        // capSize,stalkHeight,stalkTop,stalkBottom,capScaleY

        var m1 = new Mushroom(65, 100, 19, 15, 1.6, 1);
        var m2 = new Mushroom(65, 100, 19, 15, 1.6, 1);

       // Mushroom1
        m1.setColors("0xff00ba", "0xbbba00", "0xffba00");
        m1.setTextures("./img/cap1.png", "./img/ucap1.png", "./img/stalk1.png");
        m1.growIt();

        m1.model.id = "m1";
        m1.model.children[0].id = "cap1";
        m1.model.children[1].id = "ucap1";
        m1.model.children[2].id = "stalk1";
        m1.model.children[2].material.map.wrapT = THREE.RepeatWrapping;
        m1.model.children[0].material.map.wrapS = THREE.RepeatWrapping;
        m1.model.children[0].material.map.repeat.set(3, 1);

        // adding the single mushroom
        m1.model.position.copy(
          new THREE.Vector3(-263.70491733576927, -150, -667.9713237287366)
        );

       

       // Mushroom2
        m2.setColors("0xff00ba", "0xbbba00", "0xffba00");
        m2.setTextures("./img/cap1.png", "./img/ucap1.png", "./img/stalk1.png");
        m2.growIt();

        m2.model.id = "m2";
        m2.model.children[0].id = "cap1";
        m2.model.children[1].id = "ucap1";
        m2.model.children[2].id = "stalk1";
        m2.model.children[2].material.map.wrapT = THREE.RepeatWrapping;
        m2.model.children[0].material.map.wrapS = THREE.RepeatWrapping;
        m2.model.children[0].material.map.repeat.set(3, 1);

       // m2.model.position.x = 100;
       m2.model.position.copy(
          new THREE.Vector3(-133.50400526646462, -150,  -156.27262598648872)
        );


        /*
        // adding the single mushroom
        // m2.model.position.copy(
        //   new THREE.Vector3(-40.240137585480284, +40,  204.67288742878964)
        // );

        // var newMushroomGroup=new THREE.Group()
        // newMushroomGroup.add(m1)
        */

        var shroomGroup = new THREE.Object3D();
        console.log("SHROOOMGROUPEEEEEEEEEEEEEEEEEEEEEEEEEE",shroomGroup.id)

        shroomGroup.userData.name ="Anuradhapura";
        shroomGroup.userData.tooltipText = "HELLO";
        console.log("EEEEEEEEEEEEEEEEEEEEEEEEEE", shroomGroup.userData.tooltipText)

        var shroomGroup2 = new THREE.Object3D();
        console.log("SHROOOMGROUPEEEEEEEEEEEEEEEEEEEEEEEEEE",shroomGroup2.id)

        shroomGroup.add(m1.model);
        shroomGroup.add(m2.model);
        // leftright topdown frontback
        shroomGroup.position.copy(new THREE.Vector3(0, 0, 0));

        // shroomGroup2.position.copy(
        //   new THREE.Vector3(-40.240137585480284, -200, 204.67288742878964)
        // );
        // copy(new THREE.Vector3(141.39527860089362, -100, -262.84823731300366))

        scene.add(shroomGroup);
        scene.add(shroomGroup2);

        //push (cap, undercap, stalk) onto object array so can detect intersect when click
        for (var i = 0; i < 3; i++) {
          objects.push(m1.model.children[i]);
          objects.push(m2.model.children[i]);


          //console.log("****",m1.model.children[i])
        }

        mushroomList.push(m1);

        //use traverse code snippet from udacity cs291
        mushroomList[0].model.traverse(function (object) {
          if (object instanceof THREE.Mesh) {
            object.castShadow = true;
            //object.receiveShadow = true;
          }
        });
      }


      function onDocumentMouseDown(event) {
        console.log("objects.length:" + objects.length);
        console.log("objects",objects);
        event.preventDefault();

        // Annoying nested window code: need to subtract offsets for nested windows.
        // This is not needed if you have just a single window filling the browser
        // var node = event.srcElement;
        // var mouseX = event.clientX - node.offsetLeft;
        // var mouseY = event.clientY - node.offsetTop;


        /*getBoundingClientRect() -->
          gives the element's position relative to the browser's visile viewport.
          https://developer.mozilla.org/en-US/docs/Web/API/Element/getBoundingClientRect
          */  
        var canvasPosition = renderer.domElement.getBoundingClientRect();

        /*clientX/Y  -->  
        gives the mouse position relative to the browser's visible viewport.
        */

        /*we then just have to find the difference between the two
         to get the mouse position in "canvas-space"
        */

        var mouseX = event.clientX - canvasPosition.left;
        var mouseY = event.clientY - canvasPosition.top;

        console.log(canvasPosition.left, canvasPosition.top);
        console.log(mouseX, mouseY);

        /*
        while (node.offsetParent){
          node = node.offsetParent;
          mouseX -= node.offsetLeft;
          mouseY -= node.offsetTop;
        }*/


        /* the new way: simpler creation of raycaster */
        /* tutorial: http://soledadpenades.com/articles/three-js-tutorials/object-picking/ */
        var mouseVector = new THREE.Vector3( 
           2 * (mouseX / canvasWidth) - 1,                               
           1 - 2 * (mouseY / canvasHeight));

        //debug: console.log( "client Y " + event.clientY + ", mouse Y " + mouseY );
        //var raycaster = projector.pickingRay( mouseVector.clone(), camera );

        //https://stackoverflow.com/questions/29366109/three-js-three-projector-has-been-moved-to

        var raycaster = new THREE.Raycaster(); 
        var mouse = new THREE.Vector2();   

        // calculate mouse position in normalized device coordinates
        // (-1 to +1) for both components
        mouse.x = ( event.clientX / renderer.domElement.clientWidth ) * 2 - 1;
        mouse.y = - ( event.clientY / renderer.domElement.clientHeight ) * 2 + 1;


        //Adjusts the direction of the ray to point at the vector in world coordinates.
        //camera.lookAt( scene.position );

        // update the picking ray with the camera and mouse position
        raycaster.setFromCamera( mouse, camera );

        var intersects = raycaster.intersectObjects( objects );
        console.log("OBJECTS", objects)
        console.log("intersects",intersects)

        if (intersects.length > 0) {
          intersects[ 0 ].object.material.color.setRGB( Math.random(), Math.random(), Math.random() );
          intersects[ 0 ].object.name;

          var id = intersects[0].object.id;
          console.log("intersects:" + id);

          if (id == "cap1" || id == "ucap1" || id == "stalk1") {
            console.log(id);
          } else if (id == "cap2" || id == "ucap2" || id == "stalk2") {
            mushroomAction2();
          } else if (id == "cap3" || id == "ucap3" || id == "stalk3") {
            mushroomAction3();
          }

          /*
          var sphereGeom = new THREE.SphereGeometry(10);
          var sphereMaterial = new THREE.MeshBasicMaterial({color: 0xdddddd});
          
          var sphere = new THREE.Mesh( sphereGeom, sphereMaterial );
          sphere.position = intersects[ 0 ].point;
          scene.add( sphere );
          */

        }

        /*
        // Parse all the faces, for when you are using face materials
        for ( var i in intersects ) {
          intersects[ i ].face.material[ 0 ].color.setHex( Math.random() * 0xFFFFFF | 0x80000000 );
        }
        */
      }







      /*TOOLTIP*/

      // this will be 2D coordinates of the current mouse position, [0,0] is middle of the screen.
      var mouse = new THREE.Vector2();

      var latestMouseProjection; // this is the latest projection of the mouse on object (i.e. intersection with ray)
      var hoveredObj; // this objects is hovered at the moment

      // tooltip will not appear immediately. If object was hovered shortly,
      // - the timer will be canceled and tooltip will not appear at all.
      var tooltipDisplayTimeout;

      // This will move tooltip to the current mouse position and show it by timer.
      function showTooltip() {
        var divElement = $("#tooltip");

        if (divElement && latestMouseProjection) {
          divElement.css({
            display: "block",
            opacity: 0.0
          });

          var canvasHalfWidth = renderer.domElement.offsetWidth / 2;
          var canvasHalfHeight = renderer.domElement.offsetHeight / 2;

          var tooltipPosition = latestMouseProjection.clone().project(camera);
          tooltipPosition.x = (tooltipPosition.x * canvasHalfWidth) + canvasHalfWidth + renderer.domElement.offsetLeft;
          tooltipPosition.y = -(tooltipPosition.y * canvasHalfHeight) + canvasHalfHeight + renderer.domElement.offsetTop;

          var tootipWidth = divElement[0].offsetWidth;
          var tootipHeight = divElement[0].offsetHeight;

          divElement.css({
            left: `${tooltipPosition.x - tootipWidth/2}px`,
            top: `${tooltipPosition.y - tootipHeight - 5}px`
          });

          // var position = new THREE.Vector3();
          // var quaternion = new THREE.Quaternion();
          // var scale = new THREE.Vector3();
          // hoveredObj.matrix.decompose(position, quaternion, scale);

         // console.log("TOOLTIPTEXT",hoveredObj.userData.tooltipText)

           console.log("TOOLTIPTEXT",hoveredObj.id);

          const districts = [
                  { name: "Ampara", id: 1},
                  { name: "Anuradhapura", id:45 },
                  { name:"Badulla",  id:3 },
                  { name:"Batticaloa",  id:4 },
                  { name:"Colombo",  id:5 },
                  { name:"Galle",  id:6 },
                  { name:"Gampaha",  id:7 },
                  { name:"Hambantota",  id:8},
                  { name:"Jaffna",  id:41 },
                  { name:"Kalutara",  id:10 },
                  { name:"Kandy",  id:11},
                  { name:"Kegalle",  id:12 },
                  { name:"Kilinochchi",  id:13},
                  { name:"Kurunegala",  id:14},
                  { name:"Mannar",  id:15 },
                  { name:"Matale",  id:16 },
                  { name:"Matara",  id:17},
                  { name:"Moneragala", id:18 },
                  { name:"Mullaitivu",  id:19 },
                  { name:"Nuwara Eliya",  id:20},
                  { name:"Polonnaruwa",  id:21},
                  { name:"Puttalam", id:22 },
                  { name:"Ratnapura",  id:23},
                  { name:"Trincomalee",  id:24},
                  { name:"Vavuniya",  id:25 }

                ];

                for (let i = 0; i < districts.length; i++) {

                if(hoveredObj.id==districts[i].id){
                  TOOLTIPTEXT =districts[i].name;
                }

              }

          //divElement.find('span').text(hoveredObj.userData.tooltipText);
          divElement.find('span').text( TOOLTIPTEXT );

          setTimeout(function() {
            divElement.css({
              opacity: 1.0
            });
          }, 0.5);
        }
      }

      // This will immediately hide tooltip.
      function hideTooltip() {
        var divElement = $("#tooltip");
        if (divElement) {
          divElement.css({
            display: "none"
          });
        }
      }

      // Following two functions will convert mouse coordinates
      // from screen to three.js system (where [0,0] is in the middle of the screen)
      function updateMouseCoords(event, coordsObj) {
        coordsObj.x = ((event.clientX - renderer.domElement.offsetLeft + 0.5) / window.innerWidth) * 2 - 1;
        coordsObj.y = -((event.clientY - renderer.domElement.offsetTop + 0.5) / window.innerHeight) * 2 + 1;
      }

      function handleManipulationUpdate() {
        
        var raycaster = new THREE.Raycaster(); 
        raycaster.setFromCamera(mouse, camera);
        {
          var intersects = raycaster.intersectObjects(objects);
          //console.log("objectssssssssssssssssss",objects);

          if (intersects.length > 0) {
            latestMouseProjection = intersects[0].point;
            hoveredObj = intersects[0].object;
          }
        }

        if (tooltipDisplayTimeout || !latestMouseProjection) {
          clearTimeout(tooltipDisplayTimeout);
          tooltipDisplayTimeout = undefined;
          hideTooltip();
        }

        if (!tooltipDisplayTimeout && latestMouseProjection) {
          tooltipDisplayTimeout = setTimeout(function() {
            tooltipDisplayTimeout = undefined;
            showTooltip();
          }, 330);
        }
      }

      function onMouseMove(event) {
        updateMouseCoords(event, mouse);

        latestMouseProjection = undefined;
        hoveredObj = undefined;
        handleManipulationUpdate();
      }

      window.addEventListener('mousemove', onMouseMove, false);
          




    </script>
  </body>
</html>
